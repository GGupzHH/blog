(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{397:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("本文介绍如何使用"),s("code",[t._v("GitHub")]),t._v("的"),s("code",[t._v("Actions")]),t._v("去实现代码合并自动部署。\n")]),t._v(" "),s("h1",{attrs:{id:"使用github-actions实现自动部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用github-actions实现自动部署"}},[t._v("#")]),t._v(" 使用"),s("code",[t._v("GitHub Actions")]),t._v("实现自动部署")]),t._v(" "),s("h3",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Github Actions")]),t._v(" 是 Github 提供的免费自动化构建实现，特别适用于持续集成和持续交付的场景，它具备自动化完成许多不同任务的能力，例如构建、测试和部署等等。")])]),t._v(" "),s("h3",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),s("ul",[s("li",[t._v("在进行操作前，先对 "),s("code",[t._v("Github Actions")]),t._v(" 基础知识进行补充，具体可查看 "),s("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions 入门教程阮一峰"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("可以在 "),s("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Marketplace · Actions to improve your workflow"),s("OutboundLink")],1),t._v(" 中找到所有的 Actions。")])]),t._v(" "),s("h3",{attrs:{id:"开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[t._v("#")]),t._v(" 开始")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("在项目根目录创建"),s("code",[t._v(".github/workflows")]),t._v("文件夹，并且在"),s("code",[t._v("workflows")]),t._v("内生成一个 "),s("code",[t._v("workflow")]),t._v(" 文件，名字可以随便取，这个示例是"),s("code",[t._v("pages.yml")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("pages.yml")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" BlogPages\n\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pull_request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" main "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 运行在虚拟机环境ubuntu-latest")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matrix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("14.x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v1 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用的动作。格式：userName/repoName。作用：检出仓库，获取源码。 官方actions库：https://github.com/actions")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use Node.js $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" matrix.node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("version "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤2")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v1 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作用：安装nodejs")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" matrix.node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("version "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 版本")]),t._v("\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("and"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 步骤3")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CLIENT_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.CLIENT_ID "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("CLIENT_SECRET_ID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.CLIENT_SECRET_ID "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          echo '获取仓库基本信息'\n          remote_addr=`git remote get-url --push origin`\n          commit_info=`git describe --all --always --long`\n          user_name='GGupzHH'\n          user_email=`git log -1 --pretty=format:'%ae'`\n          deploy_branch=blog")]),t._v("\n\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("commit_info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("deploy_branch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n          yarn\n          yarn build\n          cd docs/.vuepress/dist\n          git config "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("global init.defaultBranch $deploy_branch\n          git init\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n          git config user.name $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          git config user.email $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_email"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          echo '设置git用户信息完成'\n\n          git add "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("A\n          git commit "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('m "auto deploy'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(' $commit_info"\n          remote_addr=`echo $remote_addr '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" awk "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("F'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//' '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("print $2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("'`\n          remote_addr=https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("secrets.BLOG_TOKEN"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          echo $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          git remote add origin $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          git push origin HEAD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$deploy_branch "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("force "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 推送到github $deploy_branch分支")]),t._v("\n\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("上面这个 workflow 文件的要点如下")]),t._v(" "),s("ul",[s("li",[t._v("整个流程在"),s("code",[t._v("main")]),t._v("分支发生"),s("code",[t._v("pull_request")]),t._v("事件时触发。")]),t._v(" "),s("li",[t._v("只有一个job，运行在虚拟机环境ubuntu-latest。")]),t._v(" "),s("li",[t._v("设置环境变量"),s("code",[t._v("CLIENT_ID")]),t._v("和"),s("code",[t._v("CLIENT_SECRET_ID")]),t._v("搭配"),s("a",{attrs:{href:"https://github.com/meteorlxy/vssue",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vssue"),s("OutboundLink")],1),t._v("登录"),s("code",[t._v("GitHub")]),t._v("账号进行评论。")]),t._v(" "),s("li",[t._v("首先获取当前仓库基本信息并且设置git用户名和邮箱。")]),t._v(" "),s("li",[t._v("安装依赖和构建打包。")]),t._v(" "),s("li",[t._v("进入到打包的目录，初始化git，设置分支和用户信息。")]),t._v(" "),s("li",[t._v("将代码暂存提交，设置远程代码仓库。")]),t._v(" "),s("li",[t._v("推送代码。")])])]),t._v(" "),s("li",[s("p",[t._v("设置自己的"),s("code",[t._v("TOKEN")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[t._v("token 只会在生成的时候显示一次，如需要再次显示，则可以点击，但使用此令牌的任何脚本或应用程序都需要更新！不过记得权限过期以及勾选上 workflow。")])]),s("ul",[s("li",[s("a",{attrs:{href:"https://ggupzhh.github.io/blog/pages/document/github/03-github-token.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Personal access tokens 生成、配置和使用"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://ggupzhh.github.io/blog/pages/document/github/03-github-actions-secrets.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Actions secrets and variables 生成、配置和使用"),s("OutboundLink")],1),t._v(" "),s("img",{attrs:{src:"/blog/images/document-github/841675839610_.pic.jpg",alt:"示例"}})])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);